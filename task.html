<!DOCTYPE html>
<html lang="en">
<head>
<title>GrabIt</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
<link href="style.css" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/3.6.1/firebase.js"></script>
<script>
// Initialize Firebase
var config = {
	apiKey: "AIzaSyCskIAWEozzbq2qUm3YXe3i2cJp0TBi_Ag",
	authDomain: "grabit-e26a4.firebaseapp.com",
	databaseURL: "https://grabit-e26a4.firebaseio.com",
	storageBucket: "",
	messagingSenderId: "548667916114"
};
firebase.initializeApp(config);

var database = firebase.database();

var id = parseInt(window.location.search.substr(1));
var user = window.sessionStorage.getItem("username");
</script>
<style type="text/css">

</style>
</head>
<body>
<header>
<span id="title">GrabIt</span>
</header>
<main>
<div class="task-name"></div>
<div class="task-poster">by <a href="#" class="task-poster-link"></a></div>
<div class="task-description"></div>
<div class="buttons">
	<a class="button main"></a>
	<a class="button" href="/tasks">Back</a>
</div>
</main>
<script type="text/javascript">
firebase.database().ref("tasks/" + id).on("value", function (data) {
	document.querySelector(".task-name").textContent = data.val().name;
	document.querySelector(".task-poster a").textContent = data.val().poster;
	document.querySelector(".task-poster a").href = "/user?" + data.val().poster;
	document.querySelector(".task-description").textContent = data.val().description;

	var mainButton = document.querySelector(".buttons .button.main");
	mainButton.classList.remove("disabled");

	if (data.val().poster == user) {
		if (data.val().grabbed) {
			mainButton.classList.add("disabled");
			mainButton.textContent = "Grabbed";
		} else {
			mainButton.onclick = function () { deleteTask(id); };
			mainButton.textContent = "Delete";
		}
	} else {
		if (data.val().grabbed) {
			if (data.val().grabbedBy == user) {
				mainButton.onclick = function () { dropTask(id); };
				mainButton.textContent = "Drop";
			} else {
				mainButton.classList.add("disabled");
				mainButton.textContent = "Grabbed";
			}
		} else {
			mainButton.onclick = function () { grabTask(id); };
			mainButton.textContent = "Grab";
		}
	}
});

function grabTask (id) {
	firebase.database().ref("tasks/" + id).update({
		grabbed: true,
		grabbedBy: user
	});
}
</script>
</body>
</html>